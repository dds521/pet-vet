<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.petvet.rag.app.mapper.RagQueryHistoryMapper">
    
    <!-- 根据会话ID查询查询历史 -->
    <select id="selectBySessionId" resultType="com.petvet.rag.app.domain.VetRagQueryHistoryEntity">
        SELECT * FROM vet_rag_query_history
        WHERE session_id = #{sessionId}
        ORDER BY create_time DESC
    </select>
    
    <!-- 根据用户ID查询查询历史 -->
    <select id="selectByUserId" resultType="com.petvet.rag.app.domain.VetRagQueryHistoryEntity">
        SELECT * FROM vet_rag_query_history
        WHERE user_id = #{userId}
        ORDER BY create_time DESC
        LIMIT #{limit}
    </select>
    
    <!-- 统计查询次数（按日期） -->
    <select id="countByDateRange" resultType="java.lang.Long">
        SELECT COUNT(*) FROM vet_rag_query_history
        WHERE create_time BETWEEN #{startDate} AND #{endDate}
        <if test="userId != null">
            AND user_id = #{userId}
        </if>
    </select>
</mapper>
